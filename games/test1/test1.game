import math
from random import randint

from art import Art
from game_object import GameObject, Player

class WobblyThing(GameObject):
    
    origin_x, origin_y, origin_z = 0, 0, 0
    
    def set_origin(self, x, y, z=None):
        self.origin_x, self.origin_y, self.origin_z = x, y, z or self.z
    
    def update(self):
        # TODO: figure out why this garbage is necessary,
        # ie the imports above don't work!
        import math
        from game_object import GameObject
        x_off = math.sin(self.app.elapsed_time / 1000) * self.origin_x
        y_off = math.sin(self.app.elapsed_time / 500) * self.origin_y
        z_off = math.sin(self.app.elapsed_time / 750) * self.origin_z
        self.x = self.origin_x + x_off
        self.y = self.origin_y + y_off
        self.z = self.origin_z + z_off
        scale_x = 0.5 + math.sin(self.app.elapsed_time / 10000) / 100
        scale_y = 0.5 + math.sin(self.app.elapsed_time / 5000) / 100
        self.set_scale(scale_x, scale_y, 1)
        GameObject.update(self)

class ParticleThing(GameObject):
    width, height = 8, 8


# background w/ parallax layers
bg = GameObject(self, self.game_art_dir + 'test_bg', (0, 0, -3))
self.player = Player(self, self.game_art_dir + 'test_player', (1, -13, 0))
# spawn a bunch of enemies
for i in range(5):
    enemy = WobblyThing(self, self.game_art_dir + 'owell')
    origin = (randint(0, 30), randint(-30, 0), randint(-5, 5))
    enemy.set_origin(*origin)
    enemy.start_animating()
# particle thingy
charset = self.app.load_charset('dos')
palette = self.app.load_palette('ega')
smoke_art = Art('smoke1', self.app, charset, palette,
                ParticleThing.width, ParticleThing.height)
smoke1 = ParticleThing(self, smoke_art, (25, -10, 0))
smoke1.art.run_script_every('mutate')
# set camera
px = self.player.x + self.player.art.width / 2
self.camera.set_loc(px, self.player.y, self.camera.z)
self.camera.set_zoom(20)
